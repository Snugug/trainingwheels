#!/usr/bin/env php
<?php

$app = require_once __DIR__ . '/bootstrap.php';

use Monolog\Logger;
use Monolog\Formatter\LineFormatter;
use Monolog\Handler\StreamHandler;
use Symfony\Component\Console\Application;
use Symfony\Component\Console\Input\InputArgument;
use Symfony\Component\Console\Input\InputInterface;
use Symfony\Component\Console\Input\InputOption;
use Symfony\Component\Console\Output\OutputInterface;
use TrainingWheels\Log\Log;
use TrainingWheels\Console\UserRetrieve;
use TrainingWheels\Console\UserCreate;
use TrainingWheels\Console\UserDelete;
use TrainingWheels\Console\ResourceCreate;
use TrainingWheels\Console\ResourceDelete;
use TrainingWheels\Console\ResourceSync;

$formatter = new LineFormatter("[%datetime%] %channel%.%level_name%: %message% \n");
$stream = new StreamHandler(__DIR__.'/../log/cli.log', Logger::DEBUG);
$stream->setFormatter($formatter);
$log = new Logger('tw');
$log->pushHandler($stream);

Log::$instance = new Log($log);
Log::log('Initializing CLI application', L_INFO);

$console = new Application();
$console->add(new UserRetrieve($app['course_factory']));
$console->add(new UserCreate($app['course_factory']));
$console->add(new UserDelete($app['course_factory']));
$console->add(new ResourceCreate($app['job_factory']));
$console->add(new ResourceDelete($app['job_factory']));
$console->add(new ResourceSync($app['job_factory']));

$console->run();
