---
##
# MongoDB install.
#
##
- name: MongoDB | Add the key
  action: command apt-key adv --keyserver keyserver.ubuntu.com --recv 7F0CEB10

- name: MongoDB | Add the MongoDB repo
  action: copy src=lib/mongodb/etc-apt-sources-list-d-mongodb-list dest=/etc/apt/sources.list.d/mongodb.list

- name: MongoDB | Update the apt cache for the new repository
  action: apt update-cache=yes

- name: MongoDB | Install Mongo
  action: apt pkg=$item state=installed
  with_items:
    - mongodb-10gen

- name: MongoDB | Restart Mongo
  action: service name=mongodb state=restarted

- name: MongoDB | Create root user
  action: shell echo "db.addUser('root', '$mongo_root_password')" | mongo admin

- name: MongoDB | Create app user
  action: shell echo "db.addUser('trainingwheels', '$mongo_app_password')" | mongo trainingwheels

- name: MongoDB | Configuration file mongodb.conf
  action: template src=templates/etc-mongodb-conf.j2 dest=/etc/mongodb.conf

- name: MongoDB | Restart Mongo
  action: service name=mongodb state=restarted
